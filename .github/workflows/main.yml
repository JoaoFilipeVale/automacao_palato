# --- My Test Robot's Brain (GitHub Actions) ---

# 1. THE NAME: I'll give a name to my "workflow" (my process).
# This is what will show up in the "Actions" tab on GitHub.
name: Playwright Regression Tests

# 2. THE TRIGGERS: When do I want this to run?
on:
  
  # Trigger A: Scheduled (Runs Monday at 5:00 AM)
  schedule:
    - cron: '0 5 * * 1'
    
  # Trigger B: Manual (Adds a "Run workflow" button)
  workflow_dispatch:

# 3. THE JOBS: What is the robot going to do?
jobs:
  run-playwright-tests:
  
    # I'll use the latest Ubuntu (Linux) virtual machine
    # that GitHub offers for free.
    runs-on: ubuntu-latest
    
    # What are the steps for this job?
    steps:
    
      # Step 1: Check-out my code (Standard)
      - name: Check-out repository
        uses: actions/checkout@v4

      # Step 2: Set up Python (Standard)
      - name: Set up Python 3.12
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      # Step 3: Install dependencies (Reading requirements.txt)
      - name: Install pip and libraries
        run: |
          # First, I'll upgrade 'pip' (the package manager)
          python -m pip install --upgrade pip
          # Then, I'll install all the tools from my 'requirements.txt'
          # This installs pytest-playwright.
          pip install -r requirements.txt
          
      # Step 4: Install Playwright Browsers
      # This downloads the actual browser binaries (Chromium, Firefox, WebKit) 
      # onto the Linux machine.
      - name: Install Playwright Browsers (Chromium, Firefox, WebKit)
        run: playwright install

      # Step 5: Run my tests!
      - name: Run PyTest (against Staging)
        run: |
          # I'll run 'pytest' and pass the '--headed' flag only if I want to see
          # the browser opening on my PC. The GitHub runner runs HEADLESS by default.
          pytest --browser=chromium --env=stag