name: Playwright Regression Tests

on:
  # Trigger A: Push to Main (Continuous Integration)
  push:
    branches: [ main ]

  # Trigger B: Scheduled (Runs Daily at 07:00 AM UTC)
  schedule:
    - cron: '0 7 * * *'

  # Trigger C: External Webhook (e.g., from WordPress Plugin Update)
  repository_dispatch:
    types: [plugin-update-event]

  # Trigger D: Manual
  workflow_dispatch:

jobs:
  run-playwright-tests:
    runs-on: ubuntu-latest
    
    steps:
      - name: Check-out repository
        uses: actions/checkout@v4

      - name: Set up Python 3.12
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install pip and libraries
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Install Playwright Browsers
        run: playwright install

      - name: Run PyTest (Production)
        run: pytest --browser=chromium --env=prod

      # --- Discord Notifications ---
      
      - name: Notify Discord (Success)
        if: success()
        uses: ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: 'âœ… **Palato Digital: Daily Health Check Passed!** All systems operational.'

      - name: Notify Discord (Failure)
        if: failure()
        uses: ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: 'ðŸš¨ **ALERT: Palato Digital Tests FAILED!** Please check GitHub Actions logs immediately.'